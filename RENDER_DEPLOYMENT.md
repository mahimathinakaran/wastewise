# WasteWise Production Deployment Guide

This guide walks you through deploying the WasteWise application to Render.com.

## Prerequisites

1. **GitHub Repository**: Your code should be pushed to GitHub
2. **MongoDB Atlas**: Database should be set up and accessible
3. **Render Account**: Create a free account at [render.com](https://render.com)

## Environment Setup

### MongoDB Connection
Your MongoDB connection string is already configured:
```
mongodb+srv://wastewise_user:wastewise_user123@cluster0.wcjs6gg.mongodb.net/wastewise_db?retryWrites=true&w=majority&appName=Cluster0
```

## Deployment Options

### Option 1: Automatic Deployment with render.yaml (Recommended)

1. **Connect GitHub Repository**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" → "Blueprint"
   - Connect your GitHub account
   - Select your `wastewise` repository
   - Render will automatically detect the `render.yaml` file

2. **Deploy Services**
   - Click "Apply" to create both backend and frontend services
   - Render will automatically:
     - Create the backend service (Python/FastAPI)
     - Create the frontend service (Node.js/Next.js)
     - Set up environment variables
     - Generate secure secrets

3. **Monitor Deployment**
   - Watch the build logs for both services
   - Backend will be available at: `https://wastewise-backend.onrender.com`
   - Frontend will be available at: `https://wastewise.onrender.com`

### Option 2: Manual Deployment

#### Backend Deployment

1. **Create Web Service**
   - Go to Render Dashboard
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: `wastewise-backend`
     - **Environment**: Python 3
     - **Build Command**: `cd backend && pip install -r requirements.txt`
     - **Start Command**: `cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT`

2. **Set Environment Variables**
   ```
   MONGODB_URL=mongodb+srv://wastewise_user:wastewise_user123@cluster0.wcjs6gg.mongodb.net/wastewise_db?retryWrites=true&w=majority&appName=Cluster0
   SECRET_KEY=[Auto-generated by Render]
   DATABASE_NAME=wastewise_db
   ACCESS_TOKEN_EXPIRE_MINUTES=1440
   ALLOWED_ORIGINS=https://wastewise.onrender.com
   ENVIRONMENT=production
   DEBUG=False
   LOG_LEVEL=INFO
   ```

#### Frontend Deployment

1. **Create Web Service**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: `wastewise`
     - **Environment**: Node
     - **Build Command**: `npm install && npm run build`
     - **Start Command**: `npm start`

2. **Set Environment Variables**
   ```
   NEXT_PUBLIC_API_URL=https://wastewise-backend.onrender.com
   NODE_ENV=production
   NEXTAUTH_URL=https://wastewise.onrender.com
   NEXTAUTH_SECRET=[Auto-generated by Render]
   ```

## Post-Deployment Setup

1. **Verify Health Check**
   - Visit: `https://wastewise-backend.onrender.com/health`
   - Should return: `{"status": "healthy", "database": "connected"}`

2. **Test API Endpoints**
   - Visit: `https://wastewise-backend.onrender.com/`
   - Should return API information

3. **Access Frontend**
   - Visit: `https://wastewise.onrender.com`
   - Test user registration and login

4. **Create Admin User**
   - The seed script will automatically create an admin user:
     - Email: `admin@wastewise.com`
     - Password: `admin123` (change after first login)

## Domain Configuration (Optional)

### Custom Domain Setup
1. Go to your service settings in Render
2. Click "Custom Domains"
3. Add your domain
4. Update DNS records as instructed
5. Update CORS origins in environment variables

## Monitoring and Maintenance

### Health Monitoring
- Health endpoint: `/health`
- Logs available in Render dashboard
- Automatic restart on failure

### Database Monitoring
- Monitor MongoDB Atlas dashboard
- Check connection limits
- Monitor storage usage

### Performance Optimization
- Enable caching headers
- Optimize image uploads
- Monitor response times

## Troubleshooting

### Common Issues

1. **CORS Errors**
   - Verify ALLOWED_ORIGINS includes your frontend URL
   - Check both frontend and backend URLs are correct

2. **Database Connection Issues**
   - Verify MongoDB connection string
   - Check IP whitelist in MongoDB Atlas
   - Ensure database user has correct permissions

3. **Build Failures**
   - Check build logs in Render dashboard
   - Verify all dependencies are in requirements.txt/package.json
   - Check Node.js/Python versions

4. **Environment Variable Issues**
   - Verify all required environment variables are set
   - Check for typos in variable names
   - Ensure secrets are properly generated

### Log Analysis
- Access logs through Render dashboard
- Check both build and runtime logs
- Look for specific error messages

## Security Considerations

- Secret keys are auto-generated by Render
- Database credentials are secured
- HTTPS is enforced by default
- CORS is properly configured
- Security headers are implemented

## Support

For deployment issues:
1. Check Render documentation
2. Review build and runtime logs
3. Verify environment variables
4. Test endpoints individually

## Cost Optimization

**Free Tier Limitations:**
- Services spin down after 15 minutes of inactivity
- First request after spin-down may be slow (cold start)
- 750 hours/month per service

**Upgrade Considerations:**
- Upgrade to paid plan for production workloads
- Paid plans provide always-on services
- Better performance and reliability